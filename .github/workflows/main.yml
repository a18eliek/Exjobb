on: push
name: ðŸš€ Deploy website on push
jobs: 
  web-deploy: 
    name: Deploy
    runs-on: ubuntu-latest
    steps: 
      - 
        name: "Get latest code"
        uses: actions/checkout@v2
      - 
        name: "Setup Node.js"
        uses: actions/setup-node@v2
        with: 
          node-version: "14"
      - 
        name: "Build Project with Node"
        run: |
            npm install
            npm run prod
      - 
        name: "Setup PHP"
        uses: shivammathur/setup-php@v2
        with: 
          coverage: none
          extensions: "dom, curl, libxml, mbstring, zip, pcntl, pdo, sqlite, pdo_sqlite"
          php-version: 7.3
      - 
        name: "Install PHP dependencies"
        uses: php-actions/composer@v5
        with: 
          command: "composer update"
      - 
        name: "ðŸ“‚ Sync files"
        uses: SamKirkland/FTP-Deploy-Action@4.0.0
        with: 
          password: "${{ secrets.ftppass }}"
          port: "${{ secrets.ftpport }}"
          server: "${{ secrets.ftpserver }}"
          username: "${{ secrets.ftpuser }}"
      - 
        name: "Copy .env"
        run: "php -r \"file_exists('.env') || copy('.env.example', '.env');\""
      - 
        name: "Generate key"
        run: "php artisan key:generate"
      - 
        name: "Directory Permissions"
        run: "chmod -R 777 storage bootstrap/cache"
name: "ðŸš€ Deploy website on push"
true: push
